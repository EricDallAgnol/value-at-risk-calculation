package com.gms.var;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;
import com.gms.var.calculation.VaRInterpolation;
import com.gms.var.calculation.VarMode;
import com.gms.var.data.entity.PnLTrade;
import com.gms.var.data.repository.PnLTradesRepository;
import com.gms.var.data.service.DataManagementService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

import java.io.File;
import java.util.Arrays;
import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;
import static org.hamcrest.Matchers.containsString;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@RunWith(SpringRunner.class)
@SpringBootTest(
        webEnvironment = SpringBootTest.WebEnvironment.MOCK,
        classes = VarApplication.class)
@AutoConfigureMockMvc
public class CalculationControllerIT {

    @Autowired
    private MockMvc mockMvc;

    @InjectMocks
    DataManagementService dataManagementService;

    @Mock
    private PnLTradesRepository pnLTradesRepository;

    @Test
    public void contextLoads() {
        assertThat(dataManagementService).isNotNull();
        assertThat(pnLTradesRepository).isNotNull();
    }

    private void sendVaRPayload(String payload, String expectedValue) throws Exception {
        mockMvc.perform(
                        post("/calculation/var")
                                .contentType(MediaType.APPLICATION_JSON)
                                .content(payload)
                )
                .andExpect(status().isOk())
                .andExpect(content().string(expectedValue));
    }

    @Test
    public void compute_var_when_no_trades() throws Exception {
        mockMvc.perform(
                post("/calculation/var")
                        .contentType(MediaType.APPLICATION_JSON)
                        .content("{}")
                )
                .andExpect(status().is5xxServerError())
                .andExpect(content().string(containsString("No trades loaded")));
    }

    @Test
    public void compute_var() throws Exception {
        String vectorStr = "-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15";
        String vectorStr2 = "-114.68,-106.71,-106.27,-94.11,-90.68,-89.78,-89.78,-85.45,-81.01,-80.15,-75.18,-67.92,-58.26,-55.32,-55.25,-54.55,-49.66,-49.36,-48.62,-47.71,-47.17,-46.56,-44.86,-44.18,-42.74,-39.14,-38.27,-36.89,-36.79,-36.62,-36.03,-35.73,-34.93,-34.05,-34.02,-33.99,-32.9,-32.5,-31.47,-30.69,-30.55,-30.1,-30.04,-29.34,-29.11,-28.38,-28.04,-27.78,-27.78,-27.14,-27.13,-26.13,-26.03,-24.14,-23.59,-22.82,-22.6,-22.53,-22.11,-21.41,-21.41,-20.51,-20.5,-20.39,-20.28,-20.12,-20.08,-20.08,-20,-19.94,-19.83,-19.7,-19.17,-19.01,-19.01,-19.01,-18.86,-18.16,-16.77,-16.29,-15.87,-15.64,-15.26,-15.15,-14.53,-14.49,-13.86,-13.68,-13.53,-13.13,-13.1,-12.47,-11.9,-11.81,-11.67,-11.6,-11.57,-11.05,-10.2,-9.34,-9.11,-8.59,-8.58,-8.4,-7.51,-6.53,-6.3,-6.21,-5.83,-5.83,-5.72,-5.67,-5.53,-5.19,-5.02,-4.87,-4.2,-4.03,-3.53,-3.05,-3,-2.27,-1.82,-1.54,-1.28,-1.22,-1.19,-1.15,-0.23,-0.07,0.3,0.61,0.7,0.74,0.76,1.15,1.39,1.94,2.37,2.47,2.65,2.92,2.95,2.98,3.36,3.4,3.67,3.73,3.9,4.09,4.44,4.45,4.86,5.73,5.79,5.84,6.25,7.3,8.35,9.06,9.2,9.54,9.91,10.33,10.71,10.79,10.86,11.79,11.8,11.88,12.61,12.7,12.86,13.88,13.94,13.96,14.31,14.48,14.81,15.35,15.7,16.6,16.92,17.16,18.6,19.69,19.82,20.29,20.57,20.87,21.76,22.01,22.4,22.58,24.11,24.55,26.23,27.61,28.9,29.05,29.28,29.3,29.79,30.38,32.59,33.56,33.98,34.14,34.36,35.7,35.76,35.88,37.8,37.99,38.9,39.36,39.42,39.74,41.24,41.27,42.31,42.57,42.72,42.75,43.15,43.41,44.18,44.28,44.67,46.69,47.66,48.35,49.88,50.59,51.63,53.12,57.64,60.24,61.24,66.86,67.64,69.27,71.27,72.86,75.35,76.22,76.91,79.27,82.79,84.15,87.74,98.06,105.88,107.93";
        double[] vector1 = Arrays.stream(vectorStr.split(",")).mapToDouble(Double::valueOf).toArray();
        double[] vector2 = Arrays.stream(vectorStr2.split(",")).mapToDouble(Double::valueOf).toArray();
        String payload = "{\"quantile\":0.99,\"mode\":\"INC\",\"interpolation\":\"HIGHER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        mockMvc.perform(
                        post("/calculation/var")
                                .contentType(MediaType.APPLICATION_JSON)
                                .content(payload)
                )
                .andExpect(status().isOk())
                .andExpect(content().string("27595.03"));
    }

    @Test
    public void compute_var_99_simple_lower_2_trades() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"SIMPLE\",\"interpolation\":\"LOWER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]},{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade2\",\"pnl\":[-114.68,-106.71,-106.27,-94.11,-90.68,-89.78,-89.78,-85.45,-81.01,-80.15,-75.18,-67.92,-58.26,-55.32,-55.25,-54.55,-49.66,-49.36,-48.62,-47.71,-47.17,-46.56,-44.86,-44.18,-42.74,-39.14,-38.27,-36.89,-36.79,-36.62,-36.03,-35.73,-34.93,-34.05,-34.02,-33.99,-32.9,-32.5,-31.47,-30.69,-30.55,-30.1,-30.04,-29.34,-29.11,-28.38,-28.04,-27.78,-27.78,-27.14,-27.13,-26.13,-26.03,-24.14,-23.59,-22.82,-22.6,-22.53,-22.11,-21.41,-21.41,-20.51,-20.5,-20.39,-20.28,-20.12,-20.08,-20.08,-20,-19.94,-19.83,-19.7,-19.17,-19.01,-19.01,-19.01,-18.86,-18.16,-16.77,-16.29,-15.87,-15.64,-15.26,-15.15,-14.53,-14.49,-13.86,-13.68,-13.53,-13.13,-13.1,-12.47,-11.9,-11.81,-11.67,-11.6,-11.57,-11.05,-10.2,-9.34,-9.11,-8.59,-8.58,-8.4,-7.51,-6.53,-6.3,-6.21,-5.83,-5.83,-5.72,-5.67,-5.53,-5.19,-5.02,-4.87,-4.2,-4.03,-3.53,-3.05,-3,-2.27,-1.82,-1.54,-1.28,-1.22,-1.19,-1.15,-0.23,-0.07,0.3,0.61,0.7,0.74,0.76,1.15,1.39,1.94,2.37,2.47,2.65,2.92,2.95,2.98,3.36,3.4,3.67,3.73,3.9,4.09,4.44,4.45,4.86,5.73,5.79,5.84,6.25,7.3,8.35,9.06,9.2,9.54,9.91,10.33,10.71,10.79,10.86,11.79,11.8,11.88,12.61,12.7,12.86,13.88,13.94,13.96,14.31,14.48,14.81,15.35,15.7,16.6,16.92,17.16,18.6,19.69,19.82,20.29,20.57,20.87,21.76,22.01,22.4,22.58,24.11,24.55,26.23,27.61,28.9,29.05,29.28,29.3,29.79,30.38,32.59,33.56,33.98,34.14,34.36,35.7,35.76,35.88,37.8,37.99,38.9,39.36,39.42,39.74,41.24,41.27,42.31,42.57,42.72,42.75,43.15,43.41,44.18,44.28,44.67,46.69,47.66,48.35,49.88,50.59,51.63,53.12,57.64,60.24,61.24,66.86,67.64,69.27,71.27,72.86,75.35,76.22,76.91,79.27,82.79,84.15,87.74,98.06,105.88,107.93]}]}";
        String expectedValue = "26195.780000000002";
        sendVaRPayload(payload, expectedValue);
    }


    @Test
    public void compute_var_99_simple_lower() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"SIMPLE\",\"interpolation\":\"LOWER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_simple_higher() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"SIMPLE\",\"interpolation\":\"HIGHER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);

    }

    @Test
    public void compute_var_99_simple_nearest() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"SIMPLE\",\"interpolation\":\"NEAREST\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);

    }

    @Test
    public void compute_var_99_simple_linear() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"SIMPLE\",\"interpolation\":\"LINEAR\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);

    }

    /****/

    @Test
    public void compute_var_99_centered_lower() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"CENTERED\",\"interpolation\":\"LOWER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_centered_higher() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"CENTERED\",\"interpolation\":\"HIGHER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_centered_nearest() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"CENTERED\",\"interpolation\":\"NEAREST\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_centered_linear() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"CENTERED\",\"interpolation\":\"LINEAR\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    /****/

    @Test
    public void compute_var_99_exc_lower() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"EXC\",\"interpolation\":\"LOWER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_exc_higher() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"EXC\",\"interpolation\":\"HIGHER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_exc_nearest() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"EXC\",\"interpolation\":\"NEAREST\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_exc_linear() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"EXC\",\"interpolation\":\"LINEAR\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    /****/

    @Test
    public void compute_var_99_inc_lower() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"INC\",\"interpolation\":\"LOWER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_inc_higher() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"INC\",\"interpolation\":\"HIGHER\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_inc_nearest() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"INC\",\"interpolation\":\"NEAREST\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

    @Test
    public void compute_var_99_inc_linear() throws Exception {
        String payload = "{\"quantile\":0.99,\"mode\":\"INC\",\"interpolation\":\"LINEAR\",\"pnLTrades\":[{\"asOfDate\":\"2023-11-06\",\"tradeID\":\"Trade1\",\"pnl\":[-37053.97,-35280.68,-35064.59,-29447.86,-29062.84,-28958.71,-28644.53,-26983.08,-26431.78,-26119.55,-24578.04,-23613.26,-23051.87,-22721.48,-22688.67,-22684.31,-22681.04,-21715.61,-20827.31,-20810.28,-20599.05,-20461.71,-20160.39,-19632.81,-19560.24,-19045.23,-18946.31,-18844.87,-18686.07,-17672.08,-17538.83,-17040.44,-16835.96,-16573.48,-16548.52,-15613.03,-15546.63,-15088.71,-14216.64,-14013.28,-13888.8,-13463.12,-13325.48,-13266.15,-13171.6,-13046.63,-12822.25,-11554.56,-11289.25,-11139.89,-11025.01,-10836.19,-10740.61,-10571.14,-10563.16,-10201.76,-10064.14,-9934.29,-9752.09,-9738.45,-9597.76,-9508.58,-9503.54,-9498.53,-9474.07,-9458.98,-9443.12,-9059.76,-8568.05,-8464.74,-8362.95,-8326.99,-7975.59,-7939.45,-7868.77,-7833.35,-7798.18,-7516.22,-7423.96,-6921.57,-6826.88,-6699.57,-6691.46,-6339.37,-5556.66,-5523.17,-5216.87,-5098.11,-5073.43,-4954.1,-4930.04,-4730.1,-4673.91,-4637.49,-4538.38,-4246.35,-4208.21,-3978.58,-3797.41,-3647.43,-3427.59,-3298.57,-3265.68,-3132.61,-3041.56,-3009.79,-3000.28,-2678.38,-2645.25,-2337.04,-2318.31,-2207.95,-2014.11,-1674.73,-1567.4,-1536.19,-1443.02,-1432.06,-1422.09,-1362.05,-1302.89,-1293.06,-1245.39,-999.25,-947.19,-853.92,-550.99,-168.28,-77.22,-30.46,253.4,465.75,646.4,651.83,703.2,749.99,786.96,798.52,836.44,874.36,923.41,967.91,1023.94,1080.56,1220.81,1250.35,1386.41,1392.46,1402.22,1642.09,1814.14,2110.91,2118.29,2184.67,2204.35,2246.1,2273.12,2384.89,2541.31,2903.88,2983.4,3331.16,3560.95,3733.21,3868.61,3888.49,3995.86,4284.55,4537.12,4583.32,4768.13,4777.03,4784.02,5097.6,5210.31,5354.93,5405.15,5472.89,5531.82,5639.74,5717.95,6079.5,6433.38,6808.26,7357.75,7527.16,7619.61,7684.59,7750.66,7795.23,7922.21,7924.26,7940.25,7990.89,8016.58,8020.4,8273.28,8417.72,8491.13,8791.51,8915.24,8916.11,8919.61,9320.61,9450.18,9494.59,9702.8,9817.76,9963.6,10073.5,10184.18,10731.11,10748.01,10789.03,11035.58,11080.83,11689.68,11909.27,12740.42,12900.67,12939.42,12989.11,13420.35,13654.33,14000.63,14093.92,14136.07,14469.97,14805.19,15148.15,15378.28,16379.17,16591.91,16837.69,17050.49,17483.05,17635.44,17683.71,17798.92,18081.76,18145.38,18660.89,19159.92,20063.43,20970.14,22476.38,22486.98,22559.65,23054.34,24548.09,24842.35,26097.72,27595.03,28388.15]}]}";
        String expectedValue = "27595.03";
        sendVaRPayload(payload, expectedValue);
    }

}
